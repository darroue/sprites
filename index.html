<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poskakující Sprites</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: Arial, sans-serif;
    }

    canvas {
      display: block;
      background: rgba(255, 255, 255, 0.1);
    }

    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>
  <div id="info">
    Chyťte a hoďte sprite! Krátký dotyk přidá nový sprite.<br>
    Počet sprites: <span id="count">0</span>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const countDisplay = document.getElementById('count');

    // Nastavení velikosti canvasu
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Seznam všech sprites
    const spriteFiles = [
      'bee.png',
      'cactus.png',
      'cat.png',
      'chameleon.png',
      'chocolate.png',
      'flower.png',
      'ice_cream.png',
      'lemon.png',
      'rasberry.png',
      'snail.png',
      'sponge_bob.png',
      'sushi.png',
      'toast.png',
      'whale.png'
    ];

    // Načtení obrázků
    const images = [];
    let loadedImages = 0;

    spriteFiles.forEach(file => {
      const img = new Image();
      img.src = `sprites/${file}`;
      img.onload = () => {
        loadedImages++;
        if (loadedImages === spriteFiles.length) {
          init();
        }
      };
      images.push(img);
    });

    // Třída pro každý sprite
    class Sprite {
      constructor(x, y, image) {
        this.image = image;
        this.size = 50 + Math.random() * 50; // Velikost 50-100px
        this.x = x !== undefined ? x : Math.random() * (canvas.width - this.size);
        this.y = y !== undefined ? y : Math.random() * (canvas.height - this.size);

        // Pohyb
        this.speedX = (Math.random() - 0.5) * 3;
        this.speedY = (Math.random() - 0.5) * 3;

        // Poskakování
        this.jumpSpeed = 0;
        this.gravity = 0.3;
        this.jumpForce = -10;
        this.onGround = false;
        this.bounceCount = 0;
        this.maxBounces = 5 + Math.floor(Math.random() * 3); // 5-7 odrazů
        this.isWalking = false;
        this.walkSpeed = 0.3 + Math.random() * 0.5; // Rychlost chůze

        // Animace
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.1;
        this.scale = 1;
        this.scaleDirection = 1;
        this.scaleSpeed = 0.01;

        // Chytání
        this.isDragging = false;
        this.dragOffsetX = 0;
        this.dragOffsetY = 0;
        this.lastVelocityX = 0;
        this.lastVelocityY = 0;
      }

      update() {
        // Pokud je chycený, neprovádí normální update
        if (this.isDragging) {
          return;
        }

        if (!this.isWalking) {
          // Režim poskakování
          this.x += this.speedX;

          this.jumpSpeed += this.gravity;
          this.y += this.jumpSpeed;

          // Kontrola podlahy
          if (this.y + this.size >= canvas.height) {
            this.y = canvas.height - this.size;
            this.bounceCount++;

            // Po určitém počtu odrazů přejdi na chůzi
            if (this.bounceCount >= this.maxBounces) {
              this.isWalking = true;
              this.jumpSpeed = 0;
              this.speedX = (Math.random() > 0.5 ? 1 : -1) * this.walkSpeed;
              this.rotationSpeed *= 0.1; // Výrazně zpomal rotaci při chůzi
            } else {
              this.jumpSpeed = this.jumpForce * Math.pow(0.5, this.bounceCount); // Rychlejší tlumení
            }
            this.onGround = true;
          } else {
            this.onGround = false;
          }

          // Kontrola stropu
          if (this.y <= 0) {
            this.y = 0;
            this.jumpSpeed = 0;
          }

          // Odraz od stěn
          if (this.x <= 0 || this.x + this.size >= canvas.width) {
            this.speedX *= -1;
            this.x = this.x <= 0 ? 0 : canvas.width - this.size;
          }
        } else {
          // Režim chůze
          this.x += this.speedX;
          this.y = canvas.height - this.size; // Drž na zemi

          // Otočení při dosažení kraje
          if (this.x <= 0 || this.x + this.size >= canvas.width) {
            this.speedX *= -1;
            this.x = this.x <= 0 ? 0 : canvas.width - this.size;
          }

          // Mírné vertikální houpání při chůzi
          this.y -= Math.abs(Math.sin(Date.now() * 0.01 * this.walkSpeed)) * 3;
        }

        // Rotace - pomalejší při chůzi
        if (this.isWalking) {
          this.rotation += this.rotationSpeed * 0.3;
        } else {
          this.rotation += this.rotationSpeed;
        }

        // Pulzující efekt - menší při chůzi
        if (this.isWalking) {
          this.scale += this.scaleSpeed * this.scaleDirection * 0.5;
          if (this.scale > 1.05 || this.scale < 0.95) {
            this.scaleDirection *= -1;
          }
        } else {
          this.scale += this.scaleSpeed * this.scaleDirection;
          if (this.scale > 1.1 || this.scale < 0.9) {
            this.scaleDirection *= -1;
          }
        }
      }

      contains(x, y) {
        return x >= this.x && x <= this.x + this.size &&
          y >= this.y && y <= this.y + this.size;
      }

      resetPhysics() {
        // Reset poskakování a zahájení nového cyklu
        this.isWalking = false;
        this.bounceCount = 0;
        this.onGround = false;
      }

      draw() {
        ctx.save();

        // Přesun do středu sprite
        ctx.translate(this.x + this.size / 2, this.y + this.size / 2);

        // Aplikace transformací
        ctx.rotate(this.rotation);
        ctx.scale(this.scale, this.scale);

        // Stín
        ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 5;

        // Vykreslení obrázku
        ctx.drawImage(
          this.image,
          -this.size / 2,
          -this.size / 2,
          this.size,
          this.size
        );

        ctx.restore();
      }
    }

    const sprites = [];

    function init() {
      // Vytvoření počátečního sprite
      const randomImage = images[Math.floor(Math.random() * images.length)];
      sprites.push(new Sprite(canvas.width / 2 - 50, 50, randomImage));
      updateCount();
      animate();
    }

    function animate() {
      // Vyčištění canvasu
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Aktualizace a vykreslení všech sprites
      sprites.forEach(sprite => {
        sprite.update();
        sprite.draw();
      });

      requestAnimationFrame(animate);
    }

    function updateCount() {
      countDisplay.textContent = sprites.length;
    }

    // Drag and drop proměnné
    let draggedSprite = null;
    let mouseX = 0;
    let mouseY = 0;
    let isDraggingAny = false;
    let touchStartTime = 0;
    let touchStartPos = { x: 0, y: 0 };
    const LONG_PRESS_DURATION = 500; // 500ms pro dlouhý dotyk

    // Funkce pro získání pozice myši/dotyku
    function getMousePos(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      }
      return {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };
    }

    // Najdi sprite pod kurzorem (poslední = nahoře)
    function getSpriteAtPosition(x, y) {
      for (let i = sprites.length - 1; i >= 0; i--) {
        if (sprites[i].contains(x, y)) {
          return sprites[i];
        }
      }
      return null;
    }

    // Mouse/Touch start - chytnutí
    function handleStart(e) {
      e.preventDefault();
      const pos = getMousePos(e);
      mouseX = pos.x;
      mouseY = pos.y;

      // Zaznamenej čas a pozici pro detekci dlouhého dotyku
      touchStartTime = Date.now();
      touchStartPos = { x: mouseX, y: mouseY };

      const sprite = getSpriteAtPosition(mouseX, mouseY);
      if (sprite) {
        draggedSprite = sprite;
        draggedSprite.isDragging = true;
        draggedSprite.dragOffsetX = mouseX - sprite.x;
        draggedSprite.dragOffsetY = mouseY - sprite.y;
        isDraggingAny = true;
        canvas.style.cursor = 'grabbing';
      }
    }

    // Mouse/Touch move - přetahování
    function handleMove(e) {
      e.preventDefault();
      const pos = getMousePos(e);
      const lastMouseX = mouseX;
      const lastMouseY = mouseY;
      mouseX = pos.x;
      mouseY = pos.y;

      if (draggedSprite) {
        draggedSprite.x = mouseX - draggedSprite.dragOffsetX;
        draggedSprite.y = mouseY - draggedSprite.dragOffsetY;
        // Uložení rychlosti pro hození
        draggedSprite.lastVelocityX = (mouseX - lastMouseX);
        draggedSprite.lastVelocityY = (mouseY - lastMouseY);
      } else {
        // Změna kurzoru při najetí na sprite
        const sprite = getSpriteAtPosition(mouseX, mouseY);
        // Mouse/Touch end - puštění/hození
        function handleEnd(e) {
          if (draggedSprite) {
            // Nastav rychlosti podle posledního pohybu (fyzika hození)
            const throwMultiplier = 0.5; // Násobitel síly hození
            draggedSprite.speedX = (draggedSprite.lastVelocityX || 0) * throwMultiplier;
            draggedSprite.jumpSpeed = (draggedSprite.lastVelocityY || 0) * throwMultiplier;

            // Přidání rotačního momentu podle horizontální rychlosti
            draggedSprite.rotationSpeed = draggedSprite.speedX * 0.02;

            draggedSprite.isDragging = false;
            draggedSprite.resetPhysics();
            draggedSprite = null;
            isDraggingAny = false;
            canvas.style.cursor = 'default';
          } else if (e.type === 'touchend' || e.type === 'touchcancel') {
            // Kontrola dlouhého dotyku pro přidání sprite na mobilu
            const touchDuration = Date.now() - touchStartTime;
            const distance = Math.sqrt(
              Math.pow(mouseX - touchStartPos.x, 2) +
              Math.pow(mouseY - touchStartPos.y, 2)
            );

            // Pokud byl dotyk krátký a bez pohybu, přidej nový sprite
            if (touchDuration < 300 && distance < 20) {
              const randomImage = images[Math.floor(Math.random() * images.length)];
              sprites.push(new Sprite(touchStartPos.x - 25, touchStartPos.y - 25, randomImage));
              updateCount();
            }
          }
        } draggedSprite = null;
        isDraggingAny = false;
        canvas.style.cursor = 'default';
      }
    }

    // Event listenery pro myš
    canvas.addEventListener('mousedown', handleStart);
    canvas.addEventListener('mousemove', handleMove);
    canvas.addEventListener('mouseup', handleEnd);
    canvas.addEventListener('mouseleave', handleEnd);

    // Event listenery pro dotyk (mobil/tablet)
    canvas.addEventListener('touchstart', handleStart);
    canvas.addEventListener('touchmove', handleMove);
    canvas.addEventListener('touchend', handleEnd);
    canvas.addEventListener('touchcancel', handleEnd);

    // Přidání nového sprite pravým tlačítkem nebo dlouhým dotekem
    canvas.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      const pos = getMousePos(e);
      const randomImage = images[Math.floor(Math.random() * images.length)];
      sprites.push(new Sprite(pos.x - 50, pos.y - 50, randomImage));
      updateCount();
    });

    // Změna velikosti okna
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>

</html>